@using TMDTNiViCi.Common
@using TMDTNiViCi.Model.EF
@model TMDTNiViCi.Model.EF.Product

@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/admin/Views/Shared/_Layout.cshtml";
}

@section cssHeader {
    <link href="~/Content/swiper-bundle.min.css" rel="stylesheet" />
    <link href="~/Assets/admin/css/Product/ListProducts.css" rel="stylesheet" />
    <link href="~/Assets/admin/css/Product/ProductDetails.css" rel="stylesheet" />
}
@section jsHeader {
    <script>
        moment.defaultFormat = "MM/DD/YYYY HH:mm:ss a";

        function moneyFormatVN(strMoney) {
            let arrStr = parseInt(strMoney).toString().split("");
            let len = arrStr.length - 1;
            for (let i = len - 1; i >= 0; i--) {
                arrStr[i] = ((len - i) % 3 == 0) ? arrStr[i] + "." : arrStr[i];
            }
            return arrStr.join("") + "đ";
        }

        let insertListener = function (event) { //Kiểm tra HTML element đã được chèn vào DOM chưa - 1.3
            if (event.animationName == "nodeInserted") {
                $(event.target).find(".money").each((index, elem) => {
                    let money = $(elem).text().trim();
                    if (money == "") {
                        $(elem).text("0đ");
                        return;
                    }
                    $(elem).text(moneyFormatVN(money));
                });
                $(event.target).find(".datetime").each((index, elem) => {
                    $(elem).text(moment($(elem).text().trim(), moment.defaultFormat).format("DD-MM-YYYY HH:mm:ss"));
                });
                $(event.target).find(".adm__tcp__action button").each((index, elem) => {
                    elem.addEventListener("click", function () {
                        let typeAc_prodId = $(this).attr("data-typeAc-prodID");
                        if (typeAc_prodId == null) { return; }
                        activeProgressBar();
                        if (typeAc_prodId[0] == "s") {
                            ajaxViewProdInfo(Number(typeAc_prodId.slice(1)));
                        } else if (typeAc_prodId[0] == "d") {
                            console.log("xoa")
                        }
                    });
                });
            }
        };

        document.addEventListener("animationstart", insertListener, false); // standard + firefox
        document.addEventListener("MSAnimationStart", insertListener, false); // IE
        document.addEventListener("webkitAnimationStart", insertListener, false); // Chrome + Safari

        function ajaxViewProdInfo(prodId) {
            $.ajax({
                url: '/Product/GetPVProductDetails',
                type: "GET",
                data: { prodId },
                success: function (partialViewResult) {
                    $("#modal-body__prod-details-area").html(partialViewResult);
                    $("#modal__view-product-detail").modal('toggle');
                    finishProgressBar(); 
                },
                error: function (err) {
                    console.log(err);
                    showNotification("error", "Lỗi hiển thị sản phẩm!");
                }
            });
        }
    </script>
    <script src="~/Scripts/alertify.min.js"></script>
}

@section breadcrumb {
    <nav class="menu-navigation">
        <ul class="breadcrumb">
            <li><a href="/Admin/Home">Trang chủ</a></li>
            <li>Quản lý sản phẩm</li>
            <li>Danh sách sản phẩm</li>
        </ul>
    </nav>
}

<div class="PC-ai__list-products">
    <div class="Pc-ai__product-filter">
        <div class="pf__filter-header-container">
            <h3 class="fhc__filter-title"> Bộ lọc </h3>
            <div class="btn-container__btn-submit">
                <button type="submit" class="filter-btn btn-primary disable-btn-default-bootstrap padding-tb-lf-5-20" form="PC-ai__product-filter-form"> Lọc </button>
            </div>
        </div>
        <div class="pf__area-contain-filter-input">
            <div class="acfi__form">
                @using (Ajax.BeginForm("Create", "Product", new AjaxOptions { HttpMethod = "POST", OnSuccess = "OnSuccessOkie", OnFailure = "OnFailure" }, new { @id = "PC-ai__product-filter-form", @class = "grid form__values-filter-ipSelectHtml" }))
                {
                    <div class="form-group">
                        <label class="control-label col-md-2"> Nhóm sản phẩm </label>
                        <div class="col-md-10">
                            @Html.DropDownListForWithTag("CategoryID", new List<AttributeProductTypeDDL> {
                                new AttributeProductTypeDDL("class", "selectpicker PC-actionCreate__DDL-html"),
                                new AttributeProductTypeDDL("id","PC-ac__product-type-ddl"),
                                new AttributeProductTypeDDL("data-size", "10"),
                                new AttributeProductTypeDDL("data-live-search", "true"),
                                new AttributeProductTypeDDL("data-width", "100%"),
                                new AttributeProductTypeDDL("title", "Chọn loại sản phẩm"),
                            }, (List<ProductCategory>)ViewBag.CategoryID, 0)
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-md-2"> Nhà cung cấp </label>
                        <div class="col-md-10">
                            @Html.DropDownListFor(model => model.Supplier, null, new { @class = "selectpicker PC-actionCreate__DDL-html", @data_width = "100%", @title = "Chọn nhà cung cấp..." })
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-md-2"> Khoảng giá </label>
                        <div class="col-md-10">
                            <div class="acfi__filter-product-price grid">
                                <div class="fpp__lowest-price">
                                    @*<label class="pf__product-filter-title-price"></label>*@
                                    <input type="text" name="lowest_price" value="" placeholder="Giá thấp nhất" class="lp__input" />
                                </div>
                                <div class="fpp__separation-lowest-highest-price text-align-center">
                                    <div class="slhp__dash pdi-top-5"><i class="fas fa-minus"></i></div>
                                </div>
                                <div class="fpp__highest-price">
                                    <input type="text" name="highest-price" value="" placeholder="Giá cao nhất" class="hp__input" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-md-2"> Trạng thái </label>
                        <div class="col-md-10">
                            <div class="filter-container-state">
                                <ul class="fct__list-states">
                                    <li class="ls__filter-display-status f__status-item">
                                        <input type="radio" id="si__radio-display" name="selector" value="1" checked="checked">
                                        <label for="si__radio-display" class="si__label"> Hiển thị </label>
                                        <div class="check"></div>
                                    </li>

                                    <li class="ls__filter-hidden-state f__status-item">
                                        <input type="radio" id="si__radio-hidden" name="selector" value="0">
                                        <label for="si__radio-hidden" class="si__label">Ẩn</label>
                                        <div class="check"><div class="inside"></div></div>
                                    </li>

                                    <li class="ls__filter-delition-status f__status-item">
                                        <input type="radio" id="si__radio-delete" name="selector" value="1">
                                        <label for="si__radio-delete" class="si__label">Xóa</label>
                                        <div class="check"><div class="inside"></div></div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
    <div class="PC-ai__add-search-products">
        <div class="adp__header grid grid-grid250">
            <div class="header__title-add">
                <h3 class="td__title"> Thêm </h3>
            </div>
            <div class="header__title-search">
                <h3 class="ts__title"> Tìm kiếm </h3>
            </div>
        </div>
        <div class="grid asp__container-add-search">

            <div class="cas__add-product flex-aic">
                <div class="lsp__ad__btn">
                    <button class="lab__btn-add-products disable-btn-default-bootstrap btn-primary">
                        <a href="/Admin/Product/Create" class="padding-tb-lf-5-20">
                            <i class="fas fa-plus"></i>
                            <span class="bap__text"> Thêm </span>
                        </a>
                    </button>
                </div>
                <div class="ad__product-numb">
                    <span class="lsp__pn__text" data-total-product="@ViewData["VDTotalProduct"]">Sản phẩm hiện có là @ViewData["VDTotalProduct"]</span>
                </div>
            </div>

            <div class="cas__search-product">
                @using (Ajax.BeginForm("Create", "Product", new AjaxOptions { HttpMethod = "POST", OnSuccess = "", OnFailure = "" }, new { @id = "PC-ai__product-search-form", @class = "grid form__values-search-ipHtml" }))
                {
                    <label class="psf__label-search"> Tìm kiếm </label>
                    <div class="psf__container-input-btnSearch">
                        <div class="admin__psf__input">
                            <input type="text" name="productName" value="" placeholder="Tên sản phẩm..." />
                        </div>
                        <div class="admin__psf__btn-submit">
                            <button class="disable-btn-default-bootstrap admin__bs__search-btn btn-primary padding-tb-lf-5-20">
                                <i class="fas fa-search"></i>
                                <span class="sb__text"> Tìm kiếm </span>
                            </button>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
    <div class="PC-ai__display-product-list">
        <div class="dpl__all-availabel-products">
            <div id="aap__wrap-prod-list" class="">
                @Html.Partial("PVProductList", ViewData["VDProductList"])
            </div>

            <div class="dpl__prod-numb-displayed">
                <span>Hiển thị</span>
                <div class="container__prodNumb-messBox">
                    <div class="message-box">
                        <div class="message-box__tooltip">
                            Gía trị phải nhỏ hơn hoặc bằng 50 và lớn hơn 7
                        </div>
                    </div>
                    <input type="text" name="prod_numb" value="8" oldValue="8" class="pnd__ip-prod-numb ip-contain-only-numb" data-divide-numb="false" style="width: 100%;" />
                </div>

                <span>sản phẩm</span>
            </div>

            <div class="paging-area">
                <ul class="pa__list-page-numbers">
                    <li class="left-arow">
                        <button class="disable-btn-default-bootstrap padding-tb-lf-5-20 lf__prev-page" data-page="0">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                    </li>

                    <li class="right-arow">
                        <button class="disable-btn-default-bootstrap padding-tb-lf-5-20 rr__next-page" data-page="2">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section jsFooter {
    <script src="~/Scripts/swiper-bundle.min.js"></script>
    <script src="~/Scripts/Common/common.js"></script>
    <script src="~/Assets/admin/js/Product/ListProducts.js"></script>
}

@section ProductSpecifications {
    <div class="fixed-viewport specifications-viewport">
        <div class="modal__prod-specificationis">
            <div class="modal__ps__table-contain-s"></div>
        </div>
    </div>
}